---
// Contact form component with validation
---

<form id="contactForm" class="space-y-6" style="display: grid; gap: 1.5rem;">
  <div class="form-group">
    <label for="name" class="form-label">Nombre completo</label>
    <input
      type="text"
      id="name"
      name="name"
      class="form-input"
      placeholder="Tu nombre completo"
      required
    />
  </div>

  <div class="form-group">
    <label for="email" class="form-label">Correo electrónico</label>
    <input
      type="email"
      id="email"
      name="email"
      class="form-input"
      placeholder="tu.email@ejemplo.com"
      required
    />
  </div>

  <div class="form-group">
    <label for="phone" class="form-label">Teléfono</label>
    <input
      type="tel"
      id="phone"
      name="phone"
      class="form-input"
      placeholder="930 928 175"
      required
    />
  </div>

  <div class="form-group">
    <label for="subject" class="form-label">Asunto</label>
    <select id="subject" name="subject" class="form-input" required>
      <option value="">Selecciona un asunto</option>
      <option value="cita">Agendar cita</option>
      <option value="consulta">Consulta médica</option>
      <option value="servicios">Información sobre servicios</option>
      <option value="seguro">Consulta sobre seguros</option>
      <option value="otro">Otro</option>
    </select>
  </div>

  <div class="form-group">
    <label for="message" class="form-label">Mensaje</label>
    <textarea
      id="message"
      name="message"
      class="form-textarea"
      rows="5"
      placeholder="Cuéntanos cómo podemos ayudarte..."
      required></textarea>
  </div>

  <button type="submit" class="btn btn--primary" style="width: 100%; justify-self: start;">
    Enviar Mensaje
  </button>
</form>

<script>
  // Form validation
  function initFormValidation() {
    const form = document.getElementById('contactForm') as HTMLFormElement;
    if (!form) return;

    // Validation functions
    function isValidEmail(email: string): boolean {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function isValidPhone(phone: string): boolean {
      const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,}$/;
      return phoneRegex.test(phone);
    }

    function validateField(field: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement): string | null {
      const value = field.value.trim();
      const type = field.getAttribute('type');
      const required = field.hasAttribute('required');

      // Clear previous errors
      clearFieldError(field);

      if (required && !value) {
        const error = 'Este campo es obligatorio';
        showFieldError(field, error);
        return error;
      }

      if (value && type === 'email' && !isValidEmail(value)) {
        const error = 'Ingresa un correo electrónico válido';
        showFieldError(field, error);
        return error;
      }

      if (value && type === 'tel' && !isValidPhone(value)) {
        const error = 'Ingresa un teléfono válido';
        showFieldError(field, error);
        return error;
      }

      return null;
    }

    function showFieldError(field: HTMLElement, message: string) {
      field.classList.add('form-input--error');

      let errorElement = field.parentNode?.querySelector('.form-error') as HTMLElement;
      if (!errorElement) {
        errorElement = document.createElement('div');
        errorElement.className = 'form-error';
        field.parentNode?.appendChild(errorElement);
      }

      errorElement.textContent = message;
    }

    function clearFieldError(field: HTMLElement) {
      field.classList.remove('form-input--error');

      const errorElement = field.parentNode?.querySelector('.form-error');
      if (errorElement) {
        errorElement.remove();
      }
    }

    function showFormSuccess() {
      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      if (submitBtn) {
        const originalText = submitBtn.textContent || 'Enviar Mensaje';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Mensaje enviado ✓';
        submitBtn.style.background = 'var(--success-color)';

        setTimeout(() => {
          submitBtn.textContent = originalText;
          submitBtn.style.background = '';
        }, 3000);
      }
    }

    function showFormLoading() {
      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Enviando...';
      }
    }

    // Add event listeners for real-time validation
    const inputs = form.querySelectorAll('input, textarea, select');
    inputs.forEach((input) => {
      input.addEventListener('blur', () => validateField(input as HTMLInputElement));
      input.addEventListener('input', () => clearFieldError(input as HTMLInputElement));
    });

    // Form submission
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // Validate all fields
      let hasErrors = false;
      inputs.forEach((input) => {
        const error = validateField(input as HTMLInputElement);
        if (error) hasErrors = true;
      });

      if (hasErrors) return;

      // Simulate form submission
      showFormLoading();

      setTimeout(() => {
        showFormSuccess();
        form.reset();
      }, 2000);
    });
  }

  // Initialize on load and on page transitions
  initFormValidation();

  document.addEventListener('astro:page-load', () => {
    initFormValidation();
  });
</script>

